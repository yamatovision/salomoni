<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆä½œæˆ - Salomoni</title>
    
    <!-- Material UI CDN -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #fce7f3 0%, #fdf2f8 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #fce7f3 0%, #fdf2f8 100%);
            padding: 1rem 2rem;
            box-shadow: none;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .header h1 {
            color: #374151;
            font-weight: 500;
            font-size: 1.5rem;
        }

        .step-indicator {
            position: absolute;
            right: 2rem;
            background: rgba(226, 152, 164, 0.1);
            border: 1px solid rgba(226, 152, 164, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #E298A4;
            font-weight: 500;
        }

        .container {
            flex: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 80px);
        }

        .chat-area {
            flex: 1;
            background: linear-gradient(180deg, #fafafa 0%, #f8fafc 100%);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(226, 152, 164, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            max-width: 70%;
            animation: fadeInUp 0.3s ease-out;
        }

        .message.ai {
            align-self: flex-start;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            flex-shrink: 0;
        }

        .avatar.ai {
            background: #F26A8D;
            box-shadow: 0 2px 8px rgba(242, 106, 141, 0.3);
        }

        .avatar.user {
            background: linear-gradient(135deg, #E298A4 0%, #D186A4 100%);
        }

        .message-content {
            background: #f8f9fa;
            padding: 1rem 1.25rem;
            border-radius: 18px;
            line-height: 1.5;
            position: relative;
        }

        .message.ai .message-content {
            background: white;
            border: 1px solid rgba(226, 152, 164, 0.1);
            color: #374151;
            border-bottom-left-radius: 6px;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #E298A4 0%, #D186A4 100%);
            color: white;
            border-bottom-right-radius: 6px;
            box-shadow: 0 3px 12px rgba(226, 152, 164, 0.3);
        }

        .input-area {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(226, 152, 164, 0.1);
            padding: 1rem;
            display: none;
            gap: 1rem;
            align-items: flex-end;
            border: 1px solid rgba(226, 152, 164, 0.2);
        }
        
        .input-area.show {
            display: flex;
        }

        .input-field {
            flex: 1;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            min-height: 20px;
            max-height: 120px;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #E298A4;
            box-shadow: 0 0 0 3px rgba(226, 152, 164, 0.1);
        }

        .send-button {
            background: linear-gradient(135deg, #E298A4 0%, #D186A4 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(226, 152, 164, 0.3);
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(226, 152, 164, 0.4);
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #E298A4;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-card {
            background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 50%, #e0e7ff 100%);
            color: #374151;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 1rem;
            border: 1px solid rgba(226, 152, 164, 0.2);
            box-shadow: 0 6px 20px rgba(226, 152, 164, 0.15);
        }

        .welcome-card h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .welcome-card p {
            font-size: 1.1rem;
            opacity: 0.9;
            line-height: 1.6;
        }

        .continue-button {
            background: #F26A8D;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(242, 106, 141, 0.3);
        }

        .continue-button:hover {
            background: #e11d48;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(242, 106, 141, 0.4);
        }

        /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .inline-form-area {
            margin: 1rem 0;
        }

        .form-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            border: 2px solid #F26A8D;
            box-shadow: 0 4px 15px rgba(242, 106, 141, 0.1);
            animation: slideUp 0.3s ease;
        }

        .form-title {
            font-size: 16px;
            font-weight: 600;
            color: #F26A8D;
            margin-bottom: 20px;
            text-align: center;
        }

        .date-form {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-select {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            background: #f8fafc;
            color: #374151;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .form-select:focus {
            outline: none;
            border-color: #F26A8D;
            background: white;
            box-shadow: 0 0 0 3px rgba(242, 106, 141, 0.1);
        }

        .form-input {
            width: 100%;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            background: #f8fafc;
            color: #374151;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .form-input:focus {
            outline: none;
            border-color: #F26A8D;
            background: white;
            box-shadow: 0 0 0 3px rgba(242, 106, 141, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 500;
            color: #374151;
            transition: color 0.3s ease;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #F26A8D;
        }

        .radio-option:hover {
            color: #F26A8D;
        }

        .location-form, .time-form {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .form-submit-btn {
            background: #F26A8D;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(242, 106, 141, 0.3);
            margin-top: 10px;
        }

        .form-submit-btn:hover {
            background: #e11d48;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(242, 106, 141, 0.4);
        }

        .form-submit-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .step-indicator {
                right: 1rem;
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
            
            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆä½œæˆ</h1>
        <div class="step-indicator" id="stepIndicator">æº–å‚™ä¸­</div>
    </header>

    <div class="container">
        <div class="chat-area" id="chatArea">
            <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚«ãƒ¼ãƒ‰ -->
            <div class="welcome-card" id="welcomeCard">
                <h2>âœ¨ AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†</h2>
                <p>ã‚ãªãŸå°‚ç”¨ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚<br>
                ç°¡å˜ãªè³ªå•ã«ãŠç­”ãˆã„ãŸã ãã ã‘ã§ã€ã‚ãªãŸã«ã´ã£ãŸã‚Šã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ãŒå®Œæˆã—ã¾ã™ã€‚</p>
                <button class="continue-button" onclick="startSetup()">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹</button>
            </div>
        </div>


        <!-- ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="input-area" id="inputArea">
            <textarea 
                class="input-field" 
                id="messageInput" 
                placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                rows="1"
            ></textarea>
            <button class="send-button" id="sendButton" onclick="sendMessage()">é€ä¿¡</button>
        </div>

        <!-- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <div class="inline-form-area" id="inlineFormArea">
            <!-- æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="form-card" id="dateForm" style="display: none;">
                <div class="form-title">ç”Ÿå¹´æœˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                <div class="date-form">
                    <select class="form-select" id="yearSelect">
                        <option value="">å¹´</option>
                    </select>
                    <select class="form-select" id="monthSelect">
                        <option value="">æœˆ</option>
                    </select>
                    <select class="form-select" id="daySelect">
                        <option value="">æ—¥</option>
                    </select>
                </div>
                <button class="form-submit-btn" onclick="submitDateForm()">æ±ºå®š</button>
            </div>

            <!-- å ´æ‰€ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="form-card" id="locationForm" style="display: none;">
                <div class="form-title">å‡ºç”Ÿåœ°ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                <div class="location-form">
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="locationType" value="japan" checked onchange="toggleLocationInput()">
                            <span>æ—¥æœ¬å›½å†…</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="locationType" value="overseas" onchange="toggleLocationInput()">
                            <span>æµ·å¤–</span>
                        </label>
                    </div>
                    <select class="form-select" id="japanSelect">
                        <option value="">éƒ½é“åºœçœŒã‚’é¸æŠ</option>
                        <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
                        <option value="é’æ£®çœŒ">é’æ£®çœŒ</option>
                        <option value="å²©æ‰‹çœŒ">å²©æ‰‹çœŒ</option>
                        <option value="å®®åŸçœŒ">å®®åŸçœŒ</option>
                        <option value="ç§‹ç”°çœŒ">ç§‹ç”°çœŒ</option>
                        <option value="å±±å½¢çœŒ">å±±å½¢çœŒ</option>
                        <option value="ç¦å³¶çœŒ">ç¦å³¶çœŒ</option>
                        <option value="èŒ¨åŸçœŒ">èŒ¨åŸçœŒ</option>
                        <option value="æ ƒæœ¨çœŒ">æ ƒæœ¨çœŒ</option>
                        <option value="ç¾¤é¦¬çœŒ">ç¾¤é¦¬çœŒ</option>
                        <option value="åŸ¼ç‰çœŒ">åŸ¼ç‰çœŒ</option>
                        <option value="åƒè‘‰çœŒ">åƒè‘‰çœŒ</option>
                        <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                        <option value="ç¥å¥ˆå·çœŒ">ç¥å¥ˆå·çœŒ</option>
                        <option value="æ–°æ½ŸçœŒ">æ–°æ½ŸçœŒ</option>
                        <option value="å¯Œå±±çœŒ">å¯Œå±±çœŒ</option>
                        <option value="çŸ³å·çœŒ">çŸ³å·çœŒ</option>
                        <option value="ç¦äº•çœŒ">ç¦äº•çœŒ</option>
                        <option value="å±±æ¢¨çœŒ">å±±æ¢¨çœŒ</option>
                        <option value="é•·é‡çœŒ">é•·é‡çœŒ</option>
                        <option value="å²é˜œçœŒ">å²é˜œçœŒ</option>
                        <option value="é™å²¡çœŒ">é™å²¡çœŒ</option>
                        <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                        <option value="ä¸‰é‡çœŒ">ä¸‰é‡çœŒ</option>
                        <option value="æ»‹è³€çœŒ">æ»‹è³€çœŒ</option>
                        <option value="äº¬éƒ½åºœ">äº¬éƒ½åºœ</option>
                        <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                        <option value="å…µåº«çœŒ">å…µåº«çœŒ</option>
                        <option value="å¥ˆè‰¯çœŒ">å¥ˆè‰¯çœŒ</option>
                        <option value="å’Œæ­Œå±±çœŒ">å’Œæ­Œå±±çœŒ</option>
                        <option value="é³¥å–çœŒ">é³¥å–çœŒ</option>
                        <option value="å³¶æ ¹çœŒ">å³¶æ ¹çœŒ</option>
                        <option value="å²¡å±±çœŒ">å²¡å±±çœŒ</option>
                        <option value="åºƒå³¶çœŒ">åºƒå³¶çœŒ</option>
                        <option value="å±±å£çœŒ">å±±å£çœŒ</option>
                        <option value="å¾³å³¶çœŒ">å¾³å³¶çœŒ</option>
                        <option value="é¦™å·çœŒ">é¦™å·çœŒ</option>
                        <option value="æ„›åª›çœŒ">æ„›åª›çœŒ</option>
                        <option value="é«˜çŸ¥çœŒ">é«˜çŸ¥çœŒ</option>
                        <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
                        <option value="ä½è³€çœŒ">ä½è³€çœŒ</option>
                        <option value="é•·å´çœŒ">é•·å´çœŒ</option>
                        <option value="ç†Šæœ¬çœŒ">ç†Šæœ¬çœŒ</option>
                        <option value="å¤§åˆ†çœŒ">å¤§åˆ†çœŒ</option>
                        <option value="å®®å´çœŒ">å®®å´çœŒ</option>
                        <option value="é¹¿å…å³¶çœŒ">é¹¿å…å³¶çœŒ</option>
                        <option value="æ²–ç¸„çœŒ">æ²–ç¸„çœŒ</option>
                    </select>
                    <input type="text" class="form-input" id="overseasInput" placeholder="å›½åã¨éƒ½å¸‚åã‚’å…¥åŠ› (ä¾‹: ã‚¢ãƒ¡ãƒªã‚« ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯)" style="display: none;">
                </div>
                <button class="form-submit-btn" onclick="submitLocationForm()">æ±ºå®š</button>
            </div>

            <!-- æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="form-card" id="timeForm" style="display: none;">
                <div class="form-title">å‡ºç”Ÿæ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                <div class="time-form">
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="timeType" value="known" checked onchange="toggleTimeInput()">
                            <span>æ™‚é–“ãŒã‚ã‹ã‚‹</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="timeType" value="unknown" onchange="toggleTimeInput()">
                            <span>ã‚ã‹ã‚‰ãªã„</span>
                        </label>
                    </div>
                    <div class="time-inputs" id="timeInputs">
                        <select class="form-select" id="hourSelect">
                            <option value="">æ™‚</option>
                        </select>
                        <select class="form-select" id="minuteSelect">
                            <option value="">åˆ†</option>
                        </select>
                    </div>
                </div>
                <button class="form-submit-btn" onclick="submitTimeForm()">æ±ºå®š</button>
            </div>
        </div>

        <!-- ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="avatar ai">AI</div>
            <div class="message-content">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—çŠ¶æ…‹ç®¡ç†
        let currentStep = 0;
        let setupData = {
            name: '',
            birthdate: '',
            birthplace: '',
            birthtime: '',
            personality: '',
            style: '',
            processing: false
        };

        const steps = [
            {
                id: 'name',
                indicator: 'ã‚¹ãƒ†ãƒƒãƒ— 1/6',
                question: 'ã¾ãšã€AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«ã©ã‚“ãªåå‰ã‚’ã¤ã‘ãŸã„ã§ã™ã‹ï¼Ÿ\n\nä¾‹ï¼šã€Œã•ãã‚‰ã€ã€Œã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ç”°ä¸­ã€ã€ŒãƒŸãƒŸã€ãªã©ã€ãŠå¥½ããªåå‰ã‚’ã©ã†ãï¼',
                placeholder: 'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...'
            },
            {
                id: 'birthdate',
                indicator: 'ã‚¹ãƒ†ãƒƒãƒ— 2/6',
                question: 'ã‚ˆã‚Šæ­£ç¢ºãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ãŸã‚ã«ã€ã‚ãªãŸã®ç”Ÿå¹´æœˆæ—¥ã‚’æ•™ãˆã¦ãã ã•ã„\n\nä¾‹ï¼šã€Œ1990å¹´5æœˆ15æ—¥ã€ã€Œ1995/3/22ã€ãªã©',
                placeholder: 'ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...'
            },
            {
                id: 'birthplace',
                indicator: 'ã‚¹ãƒ†ãƒƒãƒ— 3/6',
                question: 'å‡ºç”Ÿåœ°ã‚’æ•™ãˆã¦ãã ã•ã„\n\nä¾‹ï¼šã€Œæ±äº¬éƒ½ã€ã€Œå¤§é˜ªåºœã€ã€Œã‚¢ãƒ¡ãƒªã‚« ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯ã€ãªã©',
                placeholder: 'å‡ºç”Ÿåœ°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...'
            },
            {
                id: 'birthtime',
                indicator: 'ã‚¹ãƒ†ãƒƒãƒ— 4/6',
                question: 'å‡ºç”Ÿæ™‚é–“ãŒã‚ã‹ã‚‹å ´åˆã¯æ•™ãˆã¦ãã ã•ã„ã€‚ã‚ˆã‚Šè©³ç´°ã§æ­£ç¢ºãªåˆ†æãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\n\nã‚ã‹ã‚‰ãªã„å ´åˆã¯ã€Œã‚ã‹ã‚‰ãªã„ã€ã¾ãŸã¯ã€Œã‚¹ã‚­ãƒƒãƒ—ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„\n\nä¾‹ï¼šã€Œ14:30ã€ã€Œåˆå¾Œ2æ™‚åŠã€ã€Œã‚ã‹ã‚‰ãªã„ã€',
                placeholder: 'å‡ºç”Ÿæ™‚é–“ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€Œã‚ã‹ã‚‰ãªã„ã€ã¨å…¥åŠ›...'
            },
            {
                id: 'personality',
                indicator: 'ã‚¹ãƒ†ãƒƒãƒ— 5/6',
                question: 'ã©ã‚“ãªæ€§æ ¼ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ãŒãŠå¥½ã¿ã§ã™ã‹ï¼Ÿ\n\nä¾‹ï¼šã€Œå„ªã—ãã¦è¦ªã—ã¿ã‚„ã™ã„äººã€ã€Œãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§è©³ã—ãæ•™ãˆã¦ãã‚Œã‚‹äººã€ã€ŒåŠ±ã¾ã—ãªãŒã‚‰èƒŒä¸­ã‚’æŠ¼ã—ã¦ãã‚Œã‚‹äººã€',
                placeholder: 'ã©ã‚“ãªæ€§æ ¼ãŒè‰¯ã„ã‹æ•™ãˆã¦ãã ã•ã„...'
            },
            {
                id: 'style',
                indicator: 'ã‚¹ãƒ†ãƒƒãƒ— 6/6',
                question: 'ã©ã‚“ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãŠæ±‚ã‚ã§ã™ã‹ï¼Ÿ\n\nä¾‹ï¼šã€Œè©³ã—ãä¸å¯§ã«ã€ã€ŒåŠ±ã¾ã—ãªãŒã‚‰ã€ã€Œç°¡æ½”ã«è¦ç‚¹ã ã‘ã€ã€Œå®Ÿç”¨çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹é‡è¦–ã€',
                placeholder: 'ã©ã‚“ãªã‚¹ã‚¿ã‚¤ãƒ«ãŒè‰¯ã„ã‹æ•™ãˆã¦ãã ã•ã„...'
            }
        ];

        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–‹å§‹
        function startSetup() {
            document.getElementById('welcomeCard').style.display = 'none';
            document.getElementById('inputArea').style.display = 'flex';
            
            currentStep = 0;
            askNextQuestion();
        }

        // æ¬¡ã®è³ªå•ã‚’è¡¨ç¤º
        function askNextQuestion() {
            const step = steps[currentStep];
            document.getElementById('stepIndicator').textContent = step.indicator;
            
            setTimeout(() => {
                addAIMessage(step.question);
                showInputForStep(step);
            }, 500);
        }

        // ã‚¹ãƒ†ãƒƒãƒ—ã«å¿œã˜ãŸå…¥åŠ›ã‚’è¡¨ç¤º
        function showInputForStep(step) {
            // å…¨ã¦ã‚’éè¡¨ç¤º
            document.getElementById('inputArea').classList.remove('show');
            document.getElementById('dateForm').style.display = 'none';
            document.getElementById('locationForm').style.display = 'none';
            document.getElementById('timeForm').style.display = 'none';
            
            if (step.id === 'name' || step.id === 'personality' || step.id === 'style') {
                // ãƒãƒ£ãƒƒãƒˆå…¥åŠ›
                document.getElementById('inputArea').classList.add('show');
                document.getElementById('messageInput').placeholder = step.placeholder;
                setTimeout(() => {
                    document.getElementById('messageInput').focus();
                }, 100);
            } else if (step.id === 'birthdate') {
                // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒ 
                initializeDateForm();
                document.getElementById('dateForm').style.display = 'block';
            } else if (step.id === 'birthplace') {
                // å ´æ‰€ãƒ•ã‚©ãƒ¼ãƒ 
                document.getElementById('locationForm').style.display = 'block';
                document.getElementById('japanSelect').style.display = 'block';
                document.getElementById('overseasInput').style.display = 'none';
            } else if (step.id === 'birthtime') {
                // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒ 
                initializeTimeForm();
                document.getElementById('timeForm').style.display = 'block';
            }
        }


        // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€
        function proceedToNextStep() {
            // å…¨ã¦ã®å…¥åŠ›ã‚’éè¡¨ç¤º
            document.getElementById('inputArea').classList.remove('show');
            document.getElementById('dateForm').style.display = 'none';
            document.getElementById('locationForm').style.display = 'none';
            document.getElementById('timeForm').style.display = 'none';
            
            if (currentStep < steps.length - 1) {
                currentStep++;
                setTimeout(() => {
                    askNextQuestion();
                }, 1000);
            } else {
                completeSetup();
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || setupData.processing) return;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
            addUserMessage(message);
            input.value = '';
            
            // å…¥åŠ›ã‚’ä¿å­˜
            const step = steps[currentStep];
            setupData[step.id] = message;
            
            // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¾ãŸã¯å®Œäº†å‡¦ç†
            proceedToNextStep();
        }

        // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†
        function completeSetup() {
            setupData.processing = true;
            document.getElementById('stepIndicator').textContent = 'ä½œæˆä¸­...';
            
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                addAIMessage(`ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼ã€Œ${setupData.name}ã€ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nâœ¨ ${setupData.name}ã¯ã€Œ${setupData.personality}ã€ã¨ã„ã†æ€§æ ¼ã§ã€Œ${setupData.style}ã€ãªã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã¨ã—ã¦è¨­å®šã•ã‚Œã¾ã—ãŸã€‚\n\nğŸ“… ç”Ÿå¹´æœˆæ—¥: ${setupData.birthdate}\nğŸ“ å‡ºç”Ÿåœ°: ${setupData.birthplace}\n${setupData.birthtime ? 'ğŸ• å‡ºç”Ÿæ™‚é–“: ' + setupData.birthtime : ''}\n\nå››æŸ±æ¨å‘½ã®åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚‚è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã—ãŸã€‚ã“ã‚Œã‹ã‚‰ã‚ãªãŸã®ç¾å®¹ã¨ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚µãƒãƒ¼ãƒˆã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ï¼`);
                
                setTimeout(() => {
                    document.getElementById('stepIndicator').textContent = 'ä½œæˆå®Œäº†';
                    showCompletionButton();
                }, 1000);
            }, 2000);
        }

        // å®Œäº†ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        function showCompletionButton() {
            const chatArea = document.getElementById('chatArea');
            const completionCard = document.createElement('div');
            completionCard.className = 'welcome-card';
            completionCard.innerHTML = `
                <h2>ğŸ‰ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼</h2>
                <p>${setupData.name}ãŒã‚ãªãŸã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™</p>
                <button class="continue-button" onclick="goToChat()">ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹</button>
            `;
            chatArea.appendChild(completionCard);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸ã«ç§»å‹•
        function goToChat() {
            alert('ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™\nï¼ˆå®Ÿè£…æ™‚ã¯ /chat ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰');
        }

        // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        function addAIMessage(text) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            
            messageDiv.innerHTML = `
                <div class="avatar ai">AI</div>
                <div class="message-content">${text.replace(/\n/g, '<br>')}</div>
            `;
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        function addUserMessage(text) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            
            messageDiv.innerHTML = `
                <div class="avatar user">ã‚ãªãŸ</div>
                <div class="message-content">${text}</div>
            `;
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
        function showTyping() {
            document.getElementById('typingIndicator').classList.add('show');
        }

        // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼éè¡¨ç¤º
        function hideTyping() {
            document.getElementById('typingIndicator').classList.remove('show');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–é–¢æ•°
        function initializeDateForm() {
            const yearSelect = document.getElementById('yearSelect');
            const monthSelect = document.getElementById('monthSelect');
            const daySelect = document.getElementById('daySelect');
            
            // å¹´ã®é¸æŠè‚¢ã‚’è¿½åŠ  (1950-2010)
            yearSelect.innerHTML = '<option value="">å¹´</option>';
            for (let year = 2010; year >= 1950; year--) {
                yearSelect.innerHTML += `<option value="${year}">${year}</option>`;
            }
            
            // æœˆã®é¸æŠè‚¢ã‚’è¿½åŠ 
            monthSelect.innerHTML = '<option value="">æœˆ</option>';
            for (let month = 1; month <= 12; month++) {
                monthSelect.innerHTML += `<option value="${month}">${month}</option>`;
            }
            
            // æ—¥ã®é¸æŠè‚¢ã‚’è¿½åŠ 
            daySelect.innerHTML = '<option value="">æ—¥</option>';
            for (let day = 1; day <= 31; day++) {
                daySelect.innerHTML += `<option value="${day}">${day}</option>`;
            }
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å…¥åŠ›
            setTimeout(() => {
                yearSelect.value = '1990';
                monthSelect.value = '5';
                daySelect.value = '15';
            }, 300);
        }
        
        function initializeTimeForm() {
            const hourSelect = document.getElementById('hourSelect');
            const minuteSelect = document.getElementById('minuteSelect');
            
            // æ™‚ã®é¸æŠè‚¢ã‚’è¿½åŠ 
            hourSelect.innerHTML = '<option value="">æ™‚</option>';
            for (let hour = 0; hour <= 23; hour++) {
                const hourStr = hour.toString().padStart(2, '0');
                hourSelect.innerHTML += `<option value="${hour}">${hourStr}</option>`;
            }
            
            // åˆ†ã®é¸æŠè‚¢ã‚’è¿½åŠ 
            minuteSelect.innerHTML = '<option value="">åˆ†</option>';
            for (let minute = 0; minute <= 59; minute += 5) {
                const minuteStr = minute.toString().padStart(2, '0');
                minuteSelect.innerHTML += `<option value="${minute}">${minuteStr}</option>`;
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é–¢æ•°
        function submitDateForm() {
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;
            const day = document.getElementById('daySelect').value;
            
            if (!year || !month || !day) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const dateString = `${year}å¹´${month}æœˆ${day}æ—¥`;
            addUserMessage(dateString);
            setupData.birthdate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
            proceedToNextStep();
        }
        
        function submitLocationForm() {
            const locationType = document.querySelector('input[name=\"locationType\"]:checked').value;
            let location = '';
            
            if (locationType === 'japan') {
                location = document.getElementById('japanSelect').value;
            } else {
                location = document.getElementById('overseasInput').value;
            }
            
            if (!location) {
                alert('å‡ºç”Ÿåœ°ã‚’é¸æŠã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            addUserMessage(location);
            setupData.birthplace = location;
            proceedToNextStep();
        }
        
        function submitTimeForm() {
            const timeType = document.querySelector('input[name=\"timeType\"]:checked').value;
            
            if (timeType === 'unknown') {
                addUserMessage('ã‚ã‹ã‚‰ãªã„');
                setupData.birthtime = null;
            } else {
                const hour = document.getElementById('hourSelect').value;
                const minute = document.getElementById('minuteSelect').value;
                
                if (!hour || minute === '') {
                    alert('æ™‚é–“ã¨åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                addUserMessage(timeString);
                setupData.birthtime = timeString;
            }
            
            proceedToNextStep();
        }
        
        // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleLocationInput() {
            const locationType = document.querySelector('input[name=\"locationType\"]:checked').value;
            const japanSelect = document.getElementById('japanSelect');
            const overseasInput = document.getElementById('overseasInput');
            
            if (locationType === 'japan') {
                japanSelect.style.display = 'block';
                overseasInput.style.display = 'none';
            } else {
                japanSelect.style.display = 'none';
                overseasInput.style.display = 'block';
                overseasInput.focus();
            }
        }
        
        function toggleTimeInput() {
            const timeType = document.querySelector('input[name=\"timeType\"]:checked').value;
            const timeInputs = document.getElementById('timeInputs');
            
            if (timeType === 'known') {
                timeInputs.style.display = 'flex';
            } else {
                timeInputs.style.display = 'none';
            }
        }

        // Enteré€ä¿¡
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è‡ªå‹•èª¿æ•´
        document.getElementById('messageInput').addEventListener('input', function(e) {
            e.target.style.height = 'auto';
            e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
        });
    </script>
</body>
</html>